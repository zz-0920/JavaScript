# HTTP 状态码

HTTP状态码是服务器对客户端请求的响应代码，用于表示请求的处理结果。状态码由三位数字组成，第一位数字定义了响应的类别。

## 状态码分类

- **1xx (信息性状态码)**：请求已接收，继续处理
- **2xx (成功状态码)**：请求已成功被服务器接收、理解、并接受
- **3xx (重定向状态码)**：需要后续操作才能完成这一请求
- **4xx (客户端错误状态码)**：请求含有词法错误或者无法被执行
- **5xx (服务器错误状态码)**：服务器在处理某个正确请求时发生错误

## 1xx 信息性状态码

### 100 Continue
- **含义**：服务器已接收到请求头，客户端应继续发送请求体
- **使用场景**：大文件上传时的预检查
- **示例**：客户端发送带有`Expect: 100-continue`头的请求

### 101 Switching Protocols
- **含义**：服务器已理解客户端请求，将通过Upgrade头切换协议
- **使用场景**：HTTP升级到WebSocket
- **示例**：WebSocket握手过程

## 2xx 成功状态码

### 200 OK
- **含义**：请求成功，服务器已成功处理请求
- **使用场景**：最常见的成功响应
- **示例**：GET请求成功获取资源

### 201 Created
- **含义**：请求成功并且服务器创建了新的资源
- **使用场景**：POST请求成功创建资源
- **示例**：用户注册成功、文章发布成功

### 202 Accepted
- **含义**：服务器已接受请求，但尚未处理
- **使用场景**：异步处理场景
- **示例**：批量数据处理、邮件发送队列

### 204 No Content
- **含义**：服务器成功处理请求，但不返回任何内容
- **使用场景**：DELETE请求成功、PUT请求更新成功
- **示例**：删除资源成功、更新用户信息成功

### 206 Partial Content
- **含义**：服务器成功处理了部分GET请求
- **使用场景**：断点续传、视频流媒体
- **示例**：下载大文件时的分片下载

## 3xx 重定向状态码

### 301 Moved Permanently
- **含义**：请求的资源已永久移动到新位置
- **使用场景**：网站域名更换、URL结构调整
- **示例**：`http://example.com` → `https://example.com`
- **SEO影响**：搜索引擎会更新索引

### 302 Found (临时重定向)
- **含义**：请求的资源临时移动到新位置
- **使用场景**：临时维护页面、A/B测试
- **示例**：登录后跳转到用户页面
- **SEO影响**：搜索引擎不会更新索引

### 304 Not Modified
- **含义**：资源未修改，可以使用缓存版本
- **使用场景**：浏览器缓存机制
- **示例**：带有`If-Modified-Since`头的请求
- **优势**：减少带宽消耗，提高加载速度

### 307 Temporary Redirect
- **含义**：临时重定向，请求方法不能改变
- **使用场景**：确保POST请求在重定向后仍为POST
- **示例**：表单提交后的重定向

### 308 Permanent Redirect
- **含义**：永久重定向，请求方法不能改变
- **使用场景**：API版本升级
- **示例**：`POST /api/v1/users` → `POST /api/v2/users`

## 4xx 客户端错误状态码

### 400 Bad Request
- **含义**：请求语法错误，服务器无法理解
- **常见原因**：
  - JSON格式错误
  - 缺少必需参数
  - 参数类型错误
- **示例**：API请求参数格式不正确

### 401 Unauthorized
- **含义**：请求需要身份验证
- **使用场景**：
  - 未登录访问受保护资源
  - Token过期或无效
- **响应头**：通常包含`WWW-Authenticate`头
- **示例**：访问用户个人信息时未提供有效token

### 403 Forbidden
- **含义**：服务器理解请求，但拒绝执行
- **与401区别**：已认证但无权限
- **使用场景**：
  - 普通用户访问管理员功能
  - IP被封禁
- **示例**：普通用户尝试删除其他用户的文章

### 404 Not Found
- **含义**：请求的资源不存在
- **常见场景**：
  - URL拼写错误
  - 资源已被删除
  - 路由配置错误
- **示例**：访问不存在的页面或API端点

### 405 Method Not Allowed
- **含义**：请求方法不被允许
- **响应头**：必须包含`Allow`头说明允许的方法
- **示例**：对只支持GET的端点发送POST请求

### 409 Conflict
- **含义**：请求与服务器当前状态冲突
- **使用场景**：
  - 用户名已存在
  - 资源版本冲突
- **示例**：注册时用户名重复

### 410 Gone
- **含义**：请求的资源已永久删除
- **与404区别**：明确表示资源曾经存在但已删除
- **使用场景**：文章被永久删除、API版本废弃

### 422 Unprocessable Entity
- **含义**：请求格式正确，但语义错误
- **使用场景**：表单验证失败
- **示例**：邮箱格式正确但域名不存在

### 429 Too Many Requests
- **含义**：客户端发送请求过于频繁
- **使用场景**：API限流、防止暴力破解
- **响应头**：通常包含`Retry-After`头
- **示例**：短时间内发送过多验证码请求

## 5xx 服务器错误状态码

### 500 Internal Server Error
- **含义**：服务器内部错误
- **常见原因**：
  - 代码异常
  - 数据库连接失败
  - 配置错误
- **处理建议**：记录详细错误日志，避免向客户端暴露敏感信息

### 502 Bad Gateway
- **含义**：网关或代理服务器从上游服务器收到无效响应
- **常见场景**：
  - Nginx代理后端服务异常
  - 负载均衡器配置错误
- **示例**：应用服务器宕机，Nginx返回502

### 503 Service Unavailable
- **含义**：服务器暂时无法处理请求
- **使用场景**：
  - 服务器维护
  - 系统过载
- **响应头**：可包含`Retry-After`头
- **示例**：系统升级期间的维护页面

### 504 Gateway Timeout
- **含义**：网关或代理服务器等待上游服务器响应超时
- **常见原因**：
  - 数据库查询超时
  - 第三方API响应慢
- **示例**：复杂查询导致数据库响应超时

## 常见面试问题

### 1. 301和302的区别？
- **301**：永久重定向，搜索引擎会更新索引，浏览器会缓存重定向
- **302**：临时重定向，搜索引擎不更新索引，浏览器不缓存

### 2. 401和403的区别？
- **401**：未认证，需要登录
- **403**：已认证但无权限，登录也无法访问

### 3. 什么时候使用204？
- DELETE操作成功
- PUT更新操作成功且不需要返回更新后的资源
- OPTIONS预检请求成功

### 4. 502和504的区别？
- **502**：上游服务器返回无效响应（如返回HTML而不是JSON）
- **504**：上游服务器响应超时（完全没有响应）

## 最佳实践

### 1. 选择合适的状态码
```http
# 创建资源成功
POST /api/users
HTTP/1.1 201 Created
Location: /api/users/123

# 更新资源成功
PUT /api/users/123
HTTP/1.1 200 OK

# 删除资源成功
DELETE /api/users/123
HTTP/1.1 204 No Content
```

### 2. 错误响应包含详细信息
```json
{
  "error": {
    "code": "VALIDATION_FAILED",
    "message": "请求参数验证失败",
    "details": [
      {
        "field": "email",
        "message": "邮箱格式不正确"
      }
    ]
  }
}
```

### 3. 使用适当的缓存策略
```http
# 304响应示例
GET /api/users/123
If-Modified-Since: Wed, 21 Oct 2023 07:28:00 GMT

HTTP/1.1 304 Not Modified
Cache-Control: max-age=3600
```

### 4. 限流响应
```http
HTTP/1.1 429 Too Many Requests
Retry-After: 60
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 0
X-RateLimit-Reset: 1640995200
```

## 状态码速查表

| 状态码 | 含义 | 常见场景 |
|--------|------|----------|
| 200 | 成功 | GET请求成功 |
| 201 | 已创建 | POST创建资源 |
| 204 | 无内容 | DELETE成功 |
| 301 | 永久重定向 | 域名更换 |
| 302 | 临时重定向 | 登录跳转 |
| 304 | 未修改 | 缓存有效 |
| 400 | 请求错误 | 参数格式错误 |
| 401 | 未认证 | 需要登录 |
| 403 | 禁止访问 | 权限不足 |
| 404 | 未找到 | 资源不存在 |
| 429 | 请求过多 | 触发限流 |
| 500 | 服务器错误 | 代码异常 |
| 502 | 网关错误 | 上游服务异常 |
| 503 | 服务不可用 | 系统维护 |
| 504 | 网关超时 | 上游服务超时 |